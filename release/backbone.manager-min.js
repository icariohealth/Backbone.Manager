!function(t,e,r,n){var a,i,o,s,l,u,h,c;h=[],u=e.extend({},t.Events),c=n.location.href,s=/[:*]([^(:?)\/]+)/g,o=/\(.*\)/g,l=null,a=function(){function r(r,n){h.push(this),this.router=r,e.extend(this,t.Events),this._parseStates(),this._parseEvents(),this.initialize(n)}return r.prototype.states={},r.prototype.events={},r.prototype.initialize=function(){},r.prototype._parseStates=function(){e.each(e.keys(this.states),function(t){return function(r){var n,a,i;if(a=t.states[r],!a.transitionMethod)throw new Error(r+" needs transitionMethod definitions");if(a.url){if(e.isRegExp(a.url))throw new Error(r+" is not allowed to have a RegExp url");a._urlParams=function(){var t;for(t=[];n=s.exec(a.url);)t.push(n[1]);return t}(),i=a.url.replace(o,""),a._urlAsTemplate=e.template(i,null,{interpolate:s}),a._urlAsRegex=t.router._routeToRegExp(a.url),t.router.route(a._urlAsRegex,r,function(){t._routeCallbackChooser(r,a,Array.apply(null,arguments))})}return t.listenTo(u,r,function(e,n){t._handleTransitionCallback(r,a,e,n)})}}(this))},r.prototype._routeCallbackChooser=function(t,e,r){var n;c&&this._getWindowHref()===c?this._handleLoadCallback(t,e,r):this._handleTransitionCallback(t,e,r,{},n=!0),c=null},r.prototype._handleLoadCallback=function(t,e,r){var n;if(l=this,e.loadMethod){this.trigger("loadStart"),this.trigger("loadStart:"+t,r);try{this[e.loadMethod].apply(this,r),this.trigger("loadSuccess"),this.trigger("loadSuccess:"+t,r)}catch(a){n=a,this.trigger("loadError",n),this.trigger("loadError:"+t,r,n)}}},r.prototype._handleTransitionCallback=function(t,r,n,a,i){var o,s,u,h,c,g;if(null==a&&(a={}),null==i&&(i=!1),null==a.navigate&&(a.navigate=!0),l&&l!==this&&l.trigger("exit"),l=this,this.trigger("transitionStart"),this.trigger("transitionStart:"+t),r.url){if(n instanceof Array)h=e.object(r._urlParams,n),c=e.last(n),g=r._urlAsTemplate(h),c&&(g+=g.indexOf("?")>-1?"&":"?",g+=c),!i&&a.navigate&&this._getWindowPath()!==g&&(this.router.navigate(g),this.trigger("navigate")),o=e.map(e.initial(n),String),o.push(c);else{if(!(n instanceof Object))throw new Error("Params are only supported as an object or array if state.url is defined");g=r._urlAsTemplate(n),!i&&a.navigate&&this._getWindowPath()!==g&&(this.router.navigate(g),this.trigger("navigate")),o=this.router._extractParameters(r._urlAsRegex,g)}u={url:g},o.push(u)}else o=n;try{this[r.transitionMethod].apply(this,o),this.trigger("transitionSuccess"),this.trigger("transitionSuccess:"+t)}catch(p){s=p,this.trigger("transitionError",s),this.trigger("transitionError:"+t,s)}},r.prototype._parseEvents=function(){e.each(e.keys(this.events),function(t){return function(e){t.on(e,t[t.events[e]])}}(this))},r.prototype._parseStateFromUrl=function(t){var r,n;return n=e.find(e.keys(this.states).reverse(),function(e){return function(r){var n;return null!=(n=e.states[r]._urlAsRegex)?n.test(t):void 0}}(this)),n?(r=this.router._extractParameters(this.states[n]._urlAsRegex,t),{state:n,params:r}):void 0},r.prototype._getWindowHref=function(){return null!=n?n.location.href:void 0},r.prototype._getWindowPath=function(){return(null!=n?n.location.pathname.replace(/^\//,""):void 0)+(null!=n?n.location.search:void 0)},r.go=function(t,e,r){return e||(e=[]),e instanceof Array&&e.push(null),u.trigger(t,e,r)},r.goByUrl=function(t,r){var n,a,i,o,s;return s=document.createElement("a"),s.href=t,i=s.pathname.replace(/^\//,"")+s.search,a=null,e.find(h.slice().reverse(),function(t){return a=t._parseStateFromUrl(i)}),a?(o=a.state,n=a.params):(o="*",n=[i]),u.trigger(o,n,r)},r.extend=t.Model.extend,r.config={},r}(),t.Manager=a,i=function(t){var e,n,i,o,s,l;t.isDefaultPrevented()||(e=r(t.currentTarget),o=e.attr("data-bb-state"),l=e.attr("data-bb-options")||"{}",t.preventDefault(),""===o?a.goByUrl(t.currentTarget.href,JSON.parse(l)):(s=o.split("(",2),i=s[0],n=[],s.length>1&&s[1].length>2&&(n=JSON.parse(s[1].slice(0,s[1].indexOf(")")))),n instanceof Array&&n.push(null)),u.trigger(i,n,JSON.parse(l)))},r(n.document).on("click","a[data-bb-state]",function(t){return i(t)})}(Backbone,_,$,window);
//# sourceMappingURL=backbone.manager-min.js.map