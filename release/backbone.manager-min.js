!function(t,r,e,n){var a,i,s,o,l,u,h,c;u=[],l=r.extend({},t.Events),h=n.location.href,s=/[:*]([^(:?)/]+)/g,i=/\(.*\)/g,o=null,a=function(){function e(e,n){u.push(this),this.router=e,r.extend(this,t.Events),this._parseStates(),this._parseEvents(),this.initialize(n)}return e.prototype.states={},e.prototype.events={},e.prototype.initialize=function(){},e.prototype._parseStates=function(){r.each(r.keys(this.states),function(t){return function(e){var n,a,o;if(a=t.states[e],!a.transitionMethod)throw new Error(e+" needs transitionMethod definitions");if(a.url){if(r.isRegExp(a.url))throw new Error(e+" is not allowed to have a RegExp url");a._urlParams=function(){var t;for(t=[];n=s.exec(a.url);)t.push(n[1]);return t}(),o=a.url.replace(i,""),a._urlAsTemplate=r.template(o,null,{interpolate:s}),a._urlAsRegex=t.router._routeToRegExp(a.url),t.router.route(a._urlAsRegex,e,function(){t._routeCallbackChooser(e,a,Array.apply(null,arguments))})}return t.listenTo(l,e,function(r,n){t._handleTransitionCallback(e,a,r,n)})}}(this))},e.prototype._routeCallbackChooser=function(t,r,e){var n;h&&this._getWindowHref()===h?this._handleLoadCallback(t,r,e):this._handleTransitionCallback(t,r,e,{},n=!0),h=null},e.prototype._handleLoadCallback=function(t,r,e){var n;if(o=this,r.loadMethod){this.trigger("loadStart"),this.trigger("loadStart:"+t,e);try{this[r.loadMethod].apply(this,e),this.trigger("loadSuccess"),this.trigger("loadSuccess:"+t,e)}catch(a){n=a,this.trigger("loadError",n),this.trigger("loadError:"+t,e,n)}}},e.prototype._handleTransitionCallback=function(t,e,n,a,i){var s,l,u,h,c,g;if(null==a&&(a={}),null==i&&(i=!1),null==a.navigate&&(a.navigate=!0),o&&o!==this&&o.trigger("exit"),o=this,this.trigger("transitionStart"),this.trigger("transitionStart:"+t),e.url){if(n instanceof Array)h=r.object(e._urlParams,n),c=r.last(n),g=e._urlAsTemplate(h),c&&(g+=g.indexOf("?")>-1?"&":"?",g+=c),!i&&a.navigate&&this.router.navigate(g),s=r.map(r.initial(n),String),s.push(c);else{if(!(n instanceof Object))throw new Error("Params are only supported as an object or array if state.url is defined");g=e._urlAsTemplate(n),!i&&a.navigate&&this.router.navigate(g),s=this.router._extractParameters(e._urlAsRegex,g)}u={url:g},s.push(u)}else s=n;try{this[e.transitionMethod].apply(this,s),this.trigger("transitionSuccess"),this.trigger("transitionSuccess:"+t)}catch(p){l=p,this.trigger("transitionError",l),this.trigger("transitionError:"+t,l)}},e.prototype._parseEvents=function(){r.each(r.keys(this.events),function(t){return function(r){t.on(r,t[t.events[r]])}}(this))},e.prototype._parseStateFromUrl=function(t){var e,n;return n=r.find(r.keys(this.states).reverse(),function(r){return function(e){var n;return null!=(n=r.states[e]._urlAsRegex)?n.test(t):void 0}}(this)),n?(e=this.router._extractParameters(this.states[n]._urlAsRegex,t),{state:n,params:e}):void 0},e.prototype._getWindowHref=function(){return null!=n?n.location.href:void 0},e.go=function(t,r,e){return r||(r=[]),r instanceof Array&&r.push(null),l.trigger(t,r,e)},e.goByUrl=function(t,n){var a,i,s,o,l;return l=document.createElement("a"),l.href=t,s=l.pathname.replace(/^\//,"")+l.search,i=null,r.find(u.slice().reverse(),function(t){return i=t._parseStateFromUrl(s)}),i?(o=i.state,a=i.params):(o="*",a=[s]),e.go(o,a,n)},e.extend=t.Model.extend,e.config={},e}(),t.Manager=a,c=function(t){var r,n,i,s,o,u;t.isDefaultPrevented()||(r=e(t.currentTarget),s=r.attr("data-bb-state"),u=r.attr("data-bb-options")||"{}",t.preventDefault(),""===s?a.goByUrl(t.currentTarget.href,JSON.parse(u)):(o=s.split("(",2),i=o[0],n=[],o.length>1&&o[1].length>2&&(n=JSON.parse(o[1].slice(0,o[1].indexOf(")")))),n instanceof Array&&n.push(null)),l.trigger(i,n,JSON.parse(u)))},e(n.document).on("click","a[data-bb-state]",function(t){return c(t)})}(Backbone,_,$,window);
//# sourceMappingURL=backbone.manager-min.js.map